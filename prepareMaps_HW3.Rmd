---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

```{r}
rm(list = ls())

Link="https://github.com/meade68/DACSS_690D_Week13_HW3/raw/refs/heads/main/results_HW3.gpkg"
library(sf)
library(ggplot2)
library(leaflet)
st_layers(Link)
```

## Reading the layers:

```{r, message=FALSE}
Iowa <- st_read(Link, layer = "DisMap")

```

```         
```

# Iowa Housing Vacancy

```         
```

```{r}

# color palette for  SKATER categories
pal <- colorFactor(
  palette = "RdBu",
  domain  = Iowa$deficit_skaterR_labels,  # use the same field you map/legend
  ordered = TRUE
)

# center on Iowa 
bb <- st_bbox(Iowa)
iowa_center <- c(
  lng = mean(c(bb["xmin"], bb["xmax"])),
  lat = mean(c(bb["ymin"], bb["ymax"]))
)

Iowa_SkaterR <- leaflet(Iowa) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = iowa_center["lng"], lat = iowa_center["lat"], zoom = 7) %>%
  addPolygons(
    fillColor   = ~pal(deficit_skaterR_labels),   # match domain above
    fillOpacity = 0.7,
    color       = "white",
    weight      = 1,
    opacity     = 1,
    label       = ~paste(
      "PCT Homes Vacant:",
      round(PCT_VACANT, 2)                  # use the numeric variable here
    )
  ) %>%
  addLegend(
    pal      = pal,
    values   = ~deficit_skaterR_labels,          # same variable as fillColor
    opacity  = 0.7,
    title    = "Housing Vacancy, SKATER Clusters (Spatially Constrained)",
    position = "bottomright"
  )

Iowa_SkaterR
```

# Crime BG- interactive person crimes

```{r}

# color palette for  SKATER categories
pal <- colorFactor(
  palette = "RdBu",
  domain  = Iowa$deficit_k5_labels,  # use the same field you map/legend
  ordered = TRUE
)

# center on Iowa 
bb <- st_bbox(Iowa)
iowa_center <- c(
  lng = mean(c(bb["xmin"], bb["xmax"])),
  lat = mean(c(bb["ymin"], bb["ymax"]))
)

Iowa_K5 <- leaflet(Iowa) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = iowa_center["lng"], lat = iowa_center["lat"], zoom = 7) %>%
  addPolygons(
    fillColor   = ~pal(deficit_k5_labels),   # match domain above
    fillOpacity = 0.7,
    color       = "white",
    weight      = 1,
    opacity     = 1,
    label       = ~paste(
      "PCT Homes Vacant:",
      round(PCT_VACANT, 2)                  # use the numeric variable here
    )
  ) %>%
  addLegend(
    pal      = pal,
    values   = ~deficit_k5_labels,          # same variable as fillColor
    opacity  = 0.7,
    title    = "Housing Vacancy, K-Means Clusters (Non-Spatial)",
    position = "bottomright"
  )

Iowa_K5
```

```{r}
saveRDS(Iowa_K5,file = "Iowa_K5.rds")
saveRDS(Iowa_SkaterR,file = "Iowa_SkaterR.rds")

```
